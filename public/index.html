<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta  name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <!-- 오픈 그래프 기본 태그 -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="묘운 만세력">
    <meta property="og:description" content="정확한 만세력과 사주 정보를 제공합니다."> 
    <meta property="og:image" content="./og.png"> 
    <meta property="og:url" content="https://myowoon96.com"> 
    
    <!-- 트위터 카드 (Twitter 공유용) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="묘운 만세력">
    <meta name="twitter:description" content="정확한 만세력과 사주 정보를 제공합니다.">
    <meta name="twitter:image" content="./og.png">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

    <!-- Chrome, Firefox OS, Opera -->
    <meta name="theme-color" content="#011627">

    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#011627">

    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>묘운 만세력</title>

     <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="../src/styles/style.base.css" />
    <link rel="stylesheet" href="../src/styles/style.layout.css" />
    <link rel="stylesheet" href="../src/styles/style.result.css" />
    <link rel="stylesheet" href="../src/styles/style.detail.css" />
    <link rel="stylesheet" href="../src/styles/style.modal.css" />
    <link rel="stylesheet" href="../src/styles/style.responsive.css" />
    <script>
      function setVhUnit() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      }

      setVhUnit();

      window.addEventListener('resize', setVhUnit);
    </script>
  </head>
  <body id="app">
    <!-- 지도 모달 -->
    <div id="mapModal">
      <div id="mapContainer">
        <button id="mapCloseBtn">닫기</button>
        <div class="Rel">
          <input id="searchBox" placeholder="도시나 지명 입력을 정확히 입력해주세요." autocomplete="off"/>
          <button id="closeMap">도시선택</button>
          <ul id="suggestions"></ul>
        </div>
        <div id="map"></div>
      </div>
    </div>
    <div id="infoModal5">
      <div class="inner">
        <div class="title">
          <span>!! 안내드립니다 !! <b>만세력 UPDATE 350 ver.</b></span>
        </div>
        <div class="content">
          <ul class="infoContent">
            <li>기존에 묘운이 안맞는 부분이 있었습니다. 수정하였으나, 이미 저장된 데이터는 건드릴수가 없어서,
              번거로우시겠지만, 기존명식 모두 삭제를 해주시고 사용하시기를 권장드립니다.😂
            </li>
            <li>이 묘운 만세력은 테스트 단계이고, 만든 제가 개발자는 아닌지라 부족한 부분이 있습니다. 유의하시고 사용해주세요.</li>
            <li>원국 명식의 경우, 팔자어때 앱과 교차확인 해가며 사용하시는 것을 추천드려요!</li>
            <li>새로 고침은 자주 해주시면 좋습니다. 🥰</li>
            <li>만약 새로고침 했는데도, 명식이 계속 이상하다 싶으시면 아예 다른 환경(브라우저)에서 사용하시는 것을 권장 드립니다...:)</li>
            <li>명식 모두 삭제를 하실 경우, 브라우저 데이터가 삭제되어 팝업이 또 뜨게 됩니다 ! <br> 브라우저에서 보지 않기를 눌러주세요!
              다른 브라우저 사용 & 캐시만 비워지지 않으면 이 팝업은 또 뜨지 않습니다 !
            </li>
            <li>이용시 불편하신점은 <a href="mailto:unique950318@gmail.com">unique950318@gmail.com</a>으로 언제든 문의주세요!</li>
            <li>꼼꼼한 사용후기와 피드백은 사랑입니다 💕</li>
          </ul>
        </div>
      </div>
      <div class="btn_box">
        <button id="lognTimeX">이 이후 브라우저에서 보지 않기</button>
        <button id="closeX">닫기</button>
      </div>
    </div>
    
    <div class="container" id="container">

      <!-- 헤더 -->
      <header class="header btn_box mt0">
        <div class="inner flex_btn_2">
          <button id="backBtn" class="black_btn head_btn back_btn">명식 추가하기 +</button>
          <button id="listViewBtn" class="black_btn head_btn">명식리스트 열기</button>
          <button id="returnBtn" class="black_btn head_btn" style="display: none;">돌아가기</button>
          <button id="saveBtn" class="black_btn head_btn" style="display: none;">명식저장</button>
          <button id="setBtn" class="black_btn head_btn">⚙️설정</button>
        </div>
      </header>

      <!-- 설정 모달 (반복구조 없음) -->
      <div class="set_modal" id="setModal">
        <button class="black_btn close_btn" id="setCloaseBtn"><span>&times;</span></button>
        <ul>
          <li class="title">각종 설정</li>
          <!-- ... 기타 옵션 항목 ... -->
        </ul>
      </div>

      <!-- 사이드바 -->
      <aside id="aside" class="aside">
        <div class="inner">
          <div class="head">
            <div class="left">
              <button id="backBtnAS" class="black_btn head_btn back_btn">명식추가 +</button>
              <button class="black_btn head_btn back_btn" id="myeongsikDeleteBtn">명식 모두 삭제하기</button>
            </div>
            <button class="black_btn close_btn" id="closeBtn"><span>&times;</span></button>
          </div>
          <div class="top_search_list">
            <form class="search_form">
              <select id="searchSelect">
                <option value="이름">이름</option>
                <option value="간지">간지</option>
                <option value="생일">생일</option>
              </select>
              <input type="text" id="searchText" placeholder="이름/간지/생일로 검색가능">
              <button class="black_btn search_btn" id="searchBtn">검색</button>
            </form>
            <select id="alignType">
              <option value="정렬">정렬</option>
            </select>
          </div>
          <div class="list_ul_wrap">
            <ul class="list_ul"></ul>
            <p class="pharases" id="dragNotice" style="display: none;">왼쪽 바 버튼을 클릭하여 드래그로 순서를 바꿀 수 있습니다.</p>
            <p class="pharases" id="saveNotice">명식 저장은 브라우저 안에서만 해당됩니다.</p>
          </div>
        </div>
      </aside>

      <!-- 입력창 -->
      <div class="info_wrapper">
        <form class="input_wrap" id="inputWrap">
          <!-- (입력필드는 필요에 따라 반복X, 고정형) -->
          <div class="input_group">
            <label for="inputName">명주이름</label>
            <input type="text" id="inputName" maxlength="10" placeholder="10글자 이내로 이름 입력" />
          </div>
          <!-- ... 기타 입력 그룹 ... -->
          <div class="btn_box flex_1 mt100">
            <button type="button" id="calcBtn">산출하기</button>
            <button type="button" id="ModifyBtn">수정하기</button>
          </div>
        </form>

        <!-- 오늘의 사주 4주 (비워둠) -->
        <div class="today_meongsik_wrapper" id="todayWrapper">
          <div class="woonkuk">
            <p class="buga_title"><span>오늘의 사주</span></p>
            <ul class="grid_box grid_box_1 todaySaju"></ul>
          </div>
        </div>

        <!-- 명식 결과/표시 -->
        <div class="result_wrapper" id="resultWrapper">
          <div class="wongook_lucky" id="wongookLM">
            <div class="lucky_wrap" id="luckyWrap">
              <div class="lucky_box" id="luckyBox">
                <!-- 대운/세운/월운 등 각 운 구간 li 반복구조 모두 JS로 채움 -->
              </div>
            </div>
          </div>
          <!-- 대운/세운/월운 리스트 (모두 빈 ul로 비워둠) -->
          <ul class="grid_box grid_box_10 fortune_section reverse" id="daewoonList"></ul>
          <ul class="grid_box grid_box_10 fortune_section reverse" id="sewoonList"></ul>
          <ul class="grid_box grid_box_12 fortune_section reverse" id="mowoonList"></ul>
        </div>

        <!-- 시주예측 시간 리스트 -->
        <div class="hour_list_wrap" id="hourListWrap">
          <div class="hour_list mt20" id="hourList"></div>
        </div>
      </div>

    </div>

    <!-- 1) Leaflet CSS/JS -->
    <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <!-- 2) Leaflet-Geosearch CSS/Bundle -->
    <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet-geosearch@3.0.0/dist/geosearch.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/leaflet-geosearch@4.2.0/dist/bundle.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/korean-lunar-calendar@0.3.6/dist/korean-lunar-calendar.min.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="
    https://cdn.jsdelivr.net/npm/chinese-date-formatter@1.0.7/index.min.js
    "></script>
    
    <script type="module" src="../src/js/state.js?new"></script>
    <script type="module" src="../src/js/astro.js?new"></script>
    <script type="module" src="../src/js/core.js?new"></script>
    <script type="module" src="../src/js/ganzi.js?new"></script>
    <script type="module" src="../src/js/lucky.js?new"></script>
    <script type="module" src="../src/js/map.js?new"></script>
    <script type="module" src="../src/js/modal.js?new"></script>
    <script type="module" src="../src/js/ui.js?new"></script>
    <script type="module" src="../src/js/storage.js?new"></script>
    <script type="module" src="../src/js/app.js?new"></script>

    <script>
      const TIMEOUT_MS = 3 * 60 * 60 * 1000; // 1시간
    
      // 1. 페이지가 열릴 때 localStorage 기반 시간 체크
      const now = Date.now();
      const lastVisit = localStorage.getItem("lastVisitTime");
    
      if (lastVisit) {
        const diff = now - Number(lastVisit);
        if (diff > TIMEOUT_MS) {
          location.reload();
        }
      }
      localStorage.setItem("lastVisitTime", now);
    
      // 2. 페이지 열려있는 상태에서 일정 시간 후 새로고침
      setTimeout(() => location.reload(), TIMEOUT_MS);
    
      // 3. 모바일 백그라운드 → 다시 보일 때 시간 차 체크
      let hiddenTime = Date.now();
      document.addEventListener("visibilitychange", () => {
        if (document.visibilityState === "hidden") {
          hiddenTime = Date.now();
        } else if (document.visibilityState === "visible") {
          const now = Date.now();
          if (now - hiddenTime > TIMEOUT_MS) {
            location.reload();
          }
        }
      });
    </script>
  </body>
</html>